kernel.renderer.registrar_pagelet("renglones",function(h){var d="#"+h.id;var b,j;function a(s){var r=s.split("/");if(r.length!=3){return false}return new Date(r[2],r[1]-1,r[0])}function i(s){var r=$.trim(s.find(".escala_nota").val());return guarani.escalas().recuperar(r)}function k(r){return $.trim(r.find(".nota").val())}function l(r){return $.trim(r.find(".nota").data("valor-anterior"))}function q(s,r){return s.find(".nota").data("valor-anterior",r)}function m(r){return $.trim(r.find(".resultado").val())}function n(s){var r=k(s);if(r===""){return""}return i(s).get_resultado(r)}function f(w,u){var s=i(w);if(s.get_tipo()==="continua"){var v=k(w);if(!u){return}var t=u.keyCode||u.which;t=String.fromCharCode(t);if(!/[0-9]|\.|,/.test(t)&&u.type!=="focusout"){return}var r=s.formatear(v);w.find(".nota").val(r);q(w,r)}}function e(s){var r=n(s);s.find(".resultado").val(r)}function g(s){var r=k(s);if(r===""){return true}else{return i(s).validar(r)}}function o(s){var r=a(s.find(".fecha").val());if(s.find(".fecha").val()!==""&&(r===false||r.getTime()<b.getTime()||j.getTime()<r.getTime())){$(d).plugin_renglones("set_error",s.find(".fecha"),h.mensajes.fecha_invalida)}else{$(d).plugin_renglones("remove_error",s.find(".fecha"))}$("#herramientas #preset_undo").prop("disabled",true)}function c(t,r,s){if(!g(t)){$(d).plugin_renglones("set_error",t.find(".nota"),h.mensajes.nota_invalida)}else{if(k(t)!==""){f(t,s)}e(t);$(d).plugin_renglones("remove_error",t.find(".nota"))}$("#herramientas #preset_undo").prop("disabled",true)}function p(u,r,s){if(u.find(".nota").val()!==""){var t=i(u).get_resultado(u.find(".nota").val());if(t!==u.find(".resultado").val()){u.find(".nota").val("")}}$("#herramientas #preset_undo").prop("disabled",true)}return{onload:function(){$(d).plugin_renglones({validadores:[{tipo:["fecha"],validar:o},{tipo:["nota"],validar:c},{tipo:["resultado"],validar:p}],highlight_renglon:h.highlight_renglon,success:function(){kernel.ui.show_mensaje(h.mensajes.guardado_exitoso,{until_interaction:true})},error:function(){kernel.ui.show_mensaje(h.mensajes.guardado_error,{tipo:"alert-error"})},autocomplete:{url:h.url_autocomplete,mensaje_vacio:h.mensajes.no_se_encontraron_alumnos}});b=a(h.fecha_inicio);j=a(h.fecha_fin);$(".form-renglones").keypress(function(r){if(r==13){return false}});$("input").keypress(function(r){if(r.which==13){return false}})}}});