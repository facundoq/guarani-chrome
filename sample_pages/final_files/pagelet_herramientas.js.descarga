kernel.renderer.registrar_pagelet("herramientas",function(d){var c="#"+d.id;var i={campo:null};var b,h;function e(j){i.campo=j;$("#preset_undo").prop("disabled",false)}function f(){var j=$("#preset_campo").val();var k=j.split(",");return guarani.escalas().recuperar(k[1])}function a(k){var j=k.split("/");return new Date(j[2],j[1]-1,j[0])}function g(){var j=$("#preset_campo").val();if(j==="resultado"){$("#btnCompletar").prop("disabled",false)}else{if(($("#preset-otros").val()==="")&&($("#preset-fecha").val()==="")){$("#btnCompletar").prop("disabled",true)}else{$("#btnCompletar").prop("disabled",false)}}}return{onload:function(){$("#preset_form .fecha").datepicker();$("#preset_form").submit(function(m){m.preventDefault();var k=$("#preset_campo").val();var n=$.trim($(c).find(".preset_valor:visible").val());if(n===""){return false}$(c).find(".preset_valor:visible:not(.resultado)").val("");if(k==="fecha"&&!j(n)){return false}e(k);var l=$("#preset_solo_vacio").is(":checked");var o=$("#renglones .tabla-renglones tbody tr").clone();$("#renglones .tabla-renglones tbody tr").each(function(s){$(this).data("fechaAnt",$(o[s]).find(".fecha").val());$(this).data("notaAnt",$(o[s]).find(".nota").val());$(this).data("resultadoAnt",$(o[s]).find(".resultado").val());if(k==="fecha"){var v=$(this).find(".fecha");if($(v).is(":disabled")){return}if(l&&$(v).val()!=""){return}$(v).val(n);$(v).trigger("change");$(v).trigger("keyup")}else{if(k!=="resultado"){var r=k.split(",");var u="js-nota_instancia_"+r[0];if(!$(this).find(".nota").hasClass(u)){return}var t=f();if(!t.validar(n)){return false}else{if(t.get_tipo()==="continua"){n=t.formatear(n)}}}var q=$(this).find(".nota");var x=$(q).val();var p=$(this).find(".resultado");var w=$(p).val();if(l&&(x!=""||w!="")){return}if(k==="resultado"){$(p).val(n);$(p).trigger("change");$(p).trigger("keyup")}else{$(q).val(n);$(q).trigger("change");$(q).trigger("keyup")}}});if(k!="resultado"){$("#btnCompletar").prop("disabled",true)}$("#preset_undo").prop("disabled",false)});b=a(d.fecha_inicio);h=a(d.fecha_fin);function j(l){var k=a(l);return(k.getTime()>=b.getTime()&&k.getTime()<=h.getTime())}$("#preset_campo").change(function(){$("#preset_form").find(".preset_valor:not(.resultado)").val("");switch($(this).val()){case"fecha":$("#preset_form").find(".otros").hide();$("#preset_form").find(".resultado").hide();$("#preset_form").find(".fecha").show();$("#preset_solo_vacio").prop("disabled",false);break;case"resultado":$("#preset_form").find(".otros").hide();$("#preset_form").find(".fecha").hide();$("#preset_form").find(".resultado").show();$("#preset_solo_vacio").prop("disabled",false);break;default:$("#preset_form").find(".otros").show();$("#preset_form").find(".fecha").hide();$("#preset_form").find(".resultado").hide();$("#preset_solo_vacio").prop("disabled",false);break}});$("#preset_campo").change(function(){g()});$(".preset_valor").keyup(function(){g()});$("#preset_undo").on("click",function(){$("#renglones .tabla-renglones tbody tr").each(function(){$(this).find(".fecha").val($(this).data("fechaAnt")).trigger("change").trigger("keyup");$(this).find(".nota").val($(this).data("notaAnt")).trigger("change").trigger("keyup");$(this).find(".resultado").val($(this).data("resultadoAnt")).trigger("change").trigger("keyup")});$("#preset_undo").prop("disabled",true);if(i.campo!="resultado"){$("#btnCompletar").prop("disabled",true)}});$("#preset_form .preset_valor").change(function(){g();var k=$("#preset_campo").val();var l;if(k!=="fecha"){l=$("#preset_form .preset_valor").val();if(!f().validar(l)){$(this).find(".preset_valor:visible").val("");kernel.ui.show_mensaje(d.mensajes.nota_invalida,{tipo:"alert-error"})}}if(k==="fecha"){l=$("#preset_form .fecha").val();if(!j(l)){$(this).find(".preset_valor:visible").val("");kernel.ui.show_mensaje(d.mensajes.fecha_invalida,{tipo:"alert-error"})}}})}}});