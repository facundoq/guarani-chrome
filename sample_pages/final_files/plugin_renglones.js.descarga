(function(i){var s={nav_class:".nav",validadores:{},highlight_renglon:false,mensaje_submit_con_error:"No se puede guardar ya que hay errores",datepicker_min_date:null,datepicker_max_date:null,mostrar_prompt_perdera_cambios:false,msg_prompt_perdera_cambios:"Al realizar esta acción perderá los cambios que ha realizado, ¿desea continuar?",msg_ok_prompt_perdera_cambios:"Aceptar",msg_cancel_prompt_perdera_cambios:"Cancelar",guardar_cambio_pagina:true,success:function(){},error:function(){},autocomplete:{url:"",mensaje_vacio:"",min_letras_busqueda:1}};var b="form-renglones";var g="error";var d="alerta";var v;var r=i("<div>").addClass("info-msg").hide().on("click",function(){i(this).hide()}).appendTo(i("body"));function o(y){return y.data("tipo")}function e(B,z,A){var y;if(z=="next"){y=B.next()}else{y=B.prev()}if(y.length>0){y.find("[data-tipo='"+A+"']").select().focus()}}function p(){v.on("keydown",s.nav_class,function(B){var y=i(this);var A=y.parents("tr");var z=o(y);if(B.keyCode==13){e(A,"next",z);B.preventDefault()}if(B.keyCode==38){e(A,"prev",z)}if(B.keyCode==40){e(A,"next",z)}});v.on("focus","tr",function(){i(this).addClass("selected")});v.on("blur","tr",function(y){i(this).removeClass("selected")})}function l(y){var A=(isNaN(y))?y:i("#renglon_"+y);var z=false;i("html, body").animate({scrollTop:A.offset().top},{duration:200,complete:function(){if(z){return}A.find("td:eq(0)").addClass("resultado-busqueda");A.find("[data-tipo=nota]").focus();z=true}})}function m(){v.find("[data-tipo='fecha']").datepicker({onSelect:function(){w(i(this))},minDate:s.datepicker_min_date,maxDate:s.datepicker_max_date})}function h(){var z=v.find("."+g);var y=z.length>0;if(y){kernel.ui.show_mensaje(s.mensaje_submit_con_error,{tipo:"alert-error"});l(z)}return y}function x(y,z){return kernel.ajax.call(y.attr("action"),{type:"post",data:z,historia:false,success:function(B){v.empty().html(i(B.cont).children());k();u();var A=v.find(".error-renglon:first");if(A.length==0){s.success()}else{s.error()}},error:function(A){kernel.ui.modal({mensaje:A.cont,tipo:"alert-error"})}})}function a(y,A,z){if(s.guardar_cambio_pagina){if(h()){return false}var B=x(y,A);B.done(function(C){if(v.find(".error-renglon").length==0){guarani.cambiar_op({href:z})}})}else{guarani.cambiar_op({href:z})}}function j(){if(s.autocomplete.url==""){return}i("#notas_cursada_query").autocomplete({source:s.autocomplete.url,minLength:s.autocomplete.min_letras_busqueda,search:function(){kernel.ui.show_loading()},open:function(){},response:function(y,z){kernel.ui.hide_loading();if(z.content.length===0){kernel.ui.show_mensaje(s.autocomplete.mensaje_vacio,{tipo:"alert-error"})}},select:function(z,B){var y=v.find(".form-renglones");var A=y.serializeArray();if(s.mostrar_prompt_perdera_cambios){if(sessionStorage.hay_cambios=="true"){kernel.ui.prompt({msg:s.msg_prompt_perdera_cambios,msg_ok:s.msg_ok_prompt_perdera_cambios,msg_cancel:s.msg_cancel_prompt_perdera_cambios,ok:function(){a(y,A,B.item.id)}})}else{a(y,A,B.item.id)}}else{a(y,A,B.item.id)}}});i("#notas_cursada_query").keypress(function(y){if(y.keyCode==13){y.preventDefault()}})}function k(){q();c();m();v.find(".error-renglon").tooltip({container:"body"});j()}function f(){v.on("submit","."+b,function(){var y=i(this);var z=y.serializeArray();if(h()){return false}x(y,z);return false})}function u(){v.find("tbody tr").each(function(){var y=i(this);i(s.validadores).each(function(A,z){if(z.tipo=="inicial"){z.validar(y);return false}return true})})}function w(A,z){var B=A.parents("tr");var y=A.data("tipo");i(s.validadores).each(function(D,C){if(i.inArray(y,C.tipo)>-1){if(z){C.validar(B,y,z)}C.validar(B,y);return false}return true})}function n(){v.on("keyup blur","input",function(y){w(i(this),y)});v.on("change","select",function(){w(i(this))})}function q(){v.on("click",".pager_link",function(){var y=v.find(".form-renglones");var A=y.serializeArray();var z=i(this).prop("href");if(s.mostrar_prompt_perdera_cambios){if(sessionStorage.hay_cambios=="true"){kernel.ui.prompt({msg:s.msg_prompt_perdera_cambios,msg_ok:s.msg_ok_prompt_perdera_cambios,msg_cancel:s.msg_cancel_prompt_perdera_cambios,ok:function(){a(y,A,z)}})}else{a(y,A,z)}}else{a(y,A,z)}return false})}function c(){v.find(".ficha-alumno").on("click",function(){var y=i(this).data("url-ficha");kernel.ui.pagelet_modal(y)})}var t={init:function(z){if(z){var y={};i.extend(true,y,s,z);s=y}v=this;v.find("[data-tipo=nota]:first").focus();f();k();p();n();if(s.highlight_renglon&&s.highlight_renglon!==false){l(s.highlight_renglon)}u()},set_error:function(z,y){if(z.hasClass(g)){return}z.attr("data-original-title",y);z.tooltip({container:"body"});z.tooltip("enable");z.tooltip("show");z.addClass(g)},remove_error:function(y){if(!y.hasClass(g)){return}y.tooltip("hide");y.tooltip("disable");y.removeClass(g)},set_alerta:function(z,y){if(z.hasClass(d)){return}z.attr("data-original-title",y);z.tooltip({container:"body"});z.tooltip("enable");z.tooltip("show");z.addClass(d)},remove_alerta:function(y){if(!y.hasClass(d)){return}y.tooltip("hide");y.tooltip("disable");y.removeClass(d)}};i.fn.plugin_renglones=function(y){if(t[y]){return t[y].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof y==="object"||!y){return t.init.apply(this,arguments)}else{i.on("error","Method "+y+" doesnt exist on jQuery.upload")}}}})(jQuery);